From e16c545a08c3a89dd18b1be26d7d2a5235fd5e23 Mon Sep 17 00:00:00 2001
From: Anya Lin <hukk1996@gmail.com>
Date: Fri, 15 Dec 2023 13:14:21 +0100
Subject: [PATCH 1/3] add support for http://ping.archlinux.org/nm-check.txt
 and http://networkcheck.kde.org

---
 http_server.go | 12 ++++++++++++
 main.go        |  1 +
 2 files changed, 13 insertions(+)

diff --git a/http_server.go b/http_server.go
index 00da33c..04b8e65 100644
--- a/http_server.go
+++ b/http_server.go
@@ -24,6 +24,10 @@ func http_server_fallback(w http.ResponseWriter, req *http.Request) {
 		fmt.Fprint(w, "<html>\n<head><title>301 Moved Permanently</title></head>\n<body>\n<center><h1>301 Moved Permanently</h1></center>\n<hr><center>nginx</center>\n</body>\n</html>\n")
 		return
 
+	case "networkcheck.kde.org":
+		ok_upcase(w, req)
+		return
+
 	case "connectivitycheck.platform.hicloud.com":
 		// Huawei phones generate requests like "http://connectivitycheck.platform.hicloud.com/generate_204_1ee9b362-b226-4c81-bffe-6708fa241ab8"
 		// and the UUID is different every time
@@ -86,6 +90,7 @@ func generate_204(w http.ResponseWriter, req *http.Request) {
 }
 
 // http://network-test.debian.org/nm
+// http://ping.archlinux.org/nm-check.txt
 // http://nmcheck.gnome.org/check_network_status.txt
 // http://www.archlinux.org/check_network_status.txt
 func nm(w http.ResponseWriter, req *http.Request) {
@@ -94,6 +99,13 @@ func nm(w http.ResponseWriter, req *http.Request) {
 	fmt.Fprint(w, "NetworkManager is online\n")
 }
 
+// http://networkcheck.kde.org
+func ok_upcase(w http.ResponseWriter, req *http.Request) {
+	w.Header().Add("X-NetworkManager-Status", "online")
+	w.WriteHeader(http.StatusOK)
+	fmt.Fprint(w, "OK\n")
+}
+
 // http://detectportal.firefox.com/success.txt
 func success_txt(w http.ResponseWriter, req *http.Request) {
 	w.WriteHeader(http.StatusOK)
diff --git a/main.go b/main.go
index b3f38b5..f03dbfa 100644
--- a/main.go
+++ b/main.go
@@ -64,6 +64,7 @@ func main() {
 	mux.HandleFunc("/generate_204", generate_204)
 	mux.HandleFunc("/gen_204", generate_204)
 	mux.HandleFunc("/nm", nm)
+	mux.HandleFunc("/nm-check.txt", nm)
 	mux.HandleFunc("/check_network_status.txt", nm)
 	mux.HandleFunc("/success.txt", success_txt)
 	mux.HandleFunc("/connecttest.txt", connecttest)
-- 
2.38.0.windows.1

